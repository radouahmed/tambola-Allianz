async function postJSON(url, data){ const res=await fetch(url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)}); if(!res.ok) throw new Error(await res.text()); return res.json(); }
const form=document.getElementById('entryForm');
if(form){ form.addEventListener('submit', async (e)=>{ e.preventDefault(); const fd=new FormData(form); const data={ name:fd.get('name')?.trim(), phone:fd.get('phone')?.trim(), expiry_month:fd.get('expiry_month')?.trim(), insurance_company:fd.get('insurance_company')?.trim(), city:(fd.get('city_other')?.trim()) || fd.get('city')?.trim(), district:fd.get('district')?.trim(), intermediary:fd.get('intermediary')?.trim(), zone:fd.get('zone')?.trim(), consent: !!fd.get('consent') }; try{ const out=await postJSON('/api/entries', data); const entryId=out.entry_id; window.location.href='/wheel.html?entry_id='+encodeURIComponent(entryId); }catch(err){ alert('Erreur: v√©rifiez vos champs.'); console.error(err); } }); }